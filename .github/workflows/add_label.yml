name: add D- label on pull request

on:
  pull_request:
    types: [opened, reopened]

jobs:
  add-label:
    runs-on: ubuntu-latest
    steps:
      - name: checkout repository
        uses: actions/checkout@v3

      - name: add label
        uses: actions/github-script@v7
        with:
          script: |
            async function addLabel() { 
              try{
                const prNumber = context.payload.pull_request.number;
                const { data: labels } = await github.rest.issues.listLabelsOnIssue({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: prNumber
                });

                if (labels.some(label => label.name.startsWith('D-'))) {
                  console.log('D- label already exists.');
                  return
                } 

                await github.rest.issues.addLabels({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  issue_number: prNumber,
                  labels: ['D-5'],
                });
                console.log('Label D-5 added.');
              } catch (error) {
                console.error('Error adding labels:', error);
              }
            };
            
            addLabel();